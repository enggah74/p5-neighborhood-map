var initialUnionCityPlaces=[{types:["lodging"],name:"Holiday Inn Express",location:"37.598473,-122.0672249"},{types:["restaurant","food","establishment"],name:"Rose Garden Restaurant",location:"37.592587,-122.038542"},{types:["restaurant","food","establishment"],name:"Mexico Lindo Restaurant",location:"37.592681,-122.038815"},{types:["restaurant","food","establishment"],name:"Daa'wat",location:"37.592635,-122.03866099999999"},{types:["meal_takeaway","restaurant","food"],name:"Mr. Pickle's Sandwich Shop",location:"37.592502,-122.03847200000001"},{types:["restaurant","food","establishment"],name:"Kowloon Cafe",location:"37.596971,-122.048136"}],today=new Date,FOURSQUARE_BASE_URL="https://api.foursquare.com/v2/venues/search",FOURSQUARE_CLIENT_ID="R42ZEH51THS5SGBYAXFED5Y4FDPQDM3CE5H3RKIRICXX5QD3",FOURSQUARE_CLIENT_SECRET="JQ45ALHZFKTXREINGXUBQNA3YIJGWHOUFGA3TE4P0G2OV22V",FOURSQUARE_MODE="foursquare",FOURSQUARE_DEFAULT_ICON="https://foursquare.com/img/categories/food/default_32.png",FOURSQUARE_VERSION=today.getFullYear().toString()+("0"+(today.getMonth()+1)).slice(-2)+("0"+today.getDate()).slice(-2),map,sv,panorama,service,searchBox,unioncityCenter=new google.maps.LatLng(37.593392,-122.04383),initializeMap=function(){if(window.google){var e=document.getElementById("map-canvas"),n={center:unioncityCenter,zoom:15};map=new google.maps.Map(e,n);var o=new google.maps.LatLngBounds(new google.maps.LatLng(37.592502,-122.038472),new google.maps.LatLng(37.596971,-122.048136)),a={bounds:o};service=new google.maps.places.PlacesService(map),map.controls[google.maps.ControlPosition.LEFT_TOP].push(document.getElementById("placesId"));var t=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById(t)),searchBox=new google.maps.places.SearchBox(t,a),map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById("pano")),sv=new google.maps.StreetViewService;var i={position:unioncityCenter,pov:{heading:90,pitch:0}};panorama=new google.maps.StreetViewPanorama(document.getElementById("pano"),i),map.setStreetView(panorama)}else $("#map-canvas").html("<h1> Google Maps is not loaded. Please check your internet connection.</h1>")},UnionCityPlaceModel=function(e){this.markerOpen=ko.observable(!1),this.current_animatedMarker="",this.receivedFourSquareUpdate=ko.observable(!1),this.types=ko.observableArray(e.types),this.name=ko.observable(e.name),this.vicinity=ko.observable(),this.latitude="",this.longitude="",this.icon='<img src="'+FOURSQUARE_DEFAULT_ICON+'" />',this.nameDiv=ko.computed(function(){return console.log("name=",this.name()),'<div class="infoWindowSection"><h5>'+this.icon+"  "+this.name()+"</h5></div>"},this),this.vicinityDiv=ko.computed(function(){return'<div class="infoWindowSection"><p>Address: <span class="address">'+this.vicinity()+"</span></p></div>"},this),this.infoWindowDiv=ko.computed(function(){return'<div class="infoWindowContainer" style="width: 300px;"><div class="MarkerContent">'+this.nameDiv()+this.vicinityDiv()+"</div></div>"},this)};UnionCityPlaceModel.prototype={init:function(){var e={types:this.types(),name:this.name()},n={location:unioncityCenter,radius:2e3,name:e.name,type:e.types};service.nearbySearch(n,this.addPlaceResultsCallBack.bind(this)),this.infoWindow=new google.maps.InfoWindow({content:this.infoWindowDiv()})},addPlaceResultsCallBack:function(e,n){n===google.maps.places.PlacesServiceStatus.OK&&this.createMapMarker(e)},createMapMarker:function(e){var n=this;void 0!==e[0].vicinity&&n.vicinity(e[0].vicinity),this.name=e[0].name,this.types=e[0].types,this.latitude=e[0].geometry.location.lat(),this.longitude=e[0].geometry.location.lng(),this.newCenter=new google.maps.LatLng(this.latitude,this.longitude),this.geometryLocation=e[0].geometry.location,this.panoRadius=10,n.marker=new google.maps.Marker({map:map,position:e[0].geometry.location,title:e[0].name});var o=new google.maps.MarkerImage(e[0].icon,null,null,null,new google.maps.Size(25,25));n.marker.setIcon(o),map.setCenter(this.newCenter),google.maps.event.addListener(n.marker,"click",function(){n.markerOpen(!n.markerOpen())}),n.markerOpen()&&n.infoWindow.open(map,n.marker),n.setFoursquareInfo()},setFoursquareInfo:function(){var e=this;e.getFourSquareInfo().done(function(n){var o=n.response.venues;e.name=o[0].name,e.receivedFourSquareUpdate(!0)}).fail(function(n,o,a){e.fourSquareError('<span class="error"> Error encountered from Foursquare. Please try again. </span>'),e.name="",e.receivedFourSquareUpdate(!0);var t=o+","+a;console.log("Request Failed: "+t)})},getFourSquareInfo:function(){return $.ajax({url:FOURSQUARE_BASE_URL,type:"GET",dataType:"jsonp",contentType:"application/json",data:{client_id:FOURSQUARE_CLIENT_ID,client_secret:FOURSQUARE_CLIENT_SECRET,ll:this.latitude+","+this.longitude,query:self.name,radius:50,v:FOURSQUARE_VERSION,m:FOURSQUARE_MODE}})}};var UnionCityPlaceViewModel=function(){var e=this;e.allUnionCityPlaces=ko.observableArray([]),e.subscribeToMapClick=function(n){n.markerOpen.subscribe(function(o){o?e.setCurrentPlace(n):e.closeInfoWindow(n)})},e.subscribeToFourSquareUpdate=function(n){n.receivedFourSquareUpdate.subscribe(function(o){o&&n.infoWindow&&(n.infoWindow.setContent(n.infoWindowDiv()),n.markerOpen()&&e.getPanoramaImage())})},e.addPlace=function(n){e.subscribeToMapClick(n),e.subscribeToFourSquareUpdate(n),n.markerOpen(!0)},e.closeInfoWindows=function(){var n=e.allUnionCityPlaces().length;for(o=0;n>o;o++)e.allUnionCityPlaces()[o].infoWindow&&e.allUnionCityPlaces()[o]!==e.currentPlace()&&e.allUnionCityPlaces()[o].markerOpen(!1)},e.closeInfoWindow=function(e){e.infoWindow&&!e.markerOpen()&&e.infoWindow.close()},e.currentPlace=ko.observable(),e.setCurrentPlace=function(n){e.currentPlace(n),e.closeInfoWindows(),n.infoWindow.setContent(e.currentPlace().infoWindowDiv()),n.infoWindow.open(map,n.marker),n.geometryLocation&&e.getPanoramaImage()},e.toggleInfoWindow=function(e){e.markerOpen(!e.markerOpen())},e.getPanoramaImage=function(){sv.getPanoramaByLocation(e.currentPlace().geometryLocation,e.currentPlace().panoRadius,e.processSVData)},e.processSVData=function(n,o){if(o===google.maps.StreetViewStatus.OK){$("#panoError").removeClass("unhide"),panorama.setPano(n.location.pano);var a=google.maps.geometry.spherical.computeHeading(n.location.latLng,e.currentPlace().geometryLocation);panorama.setPov({heading:a,pitch:0}),panorama.setVisible(!0)}else o===google.maps.StreetViewStatus.ZERO_RESULTS?(e.currentPlace().panoRadius+=40,e.getPanoramaImage()):$("#panoError").addClass("unhide")};for(var n,o=0;o<initialUnionCityPlaces.length;o++)n=new UnionCityPlaceModel(initialUnionCityPlaces[o]),n.init(),e.allUnionCityPlaces.push(n),e.subscribeToMapClick(n),e.subscribeToFourSquareUpdate(n);google.maps.event.addListener(searchBox,"places_changed",function(){var n=searchBox.getPlaces();if(0!==n.length){var o=new UnionCityPlaceModel({name:n[0].name,types:n[0].types});o.init(),e.addPlace(o)}})};window.addEventListener("load",function(){function e(e){var o=navigator.onLine?"online":"offline";n.className=o,n.innerHTML=o.toUpperCase(),log.insertAdjacentHTML("beforeend","Event: "+e.type+"; Status: "+o)}var n=document.getElementById("status");window.addEventListener("online",e),window.addEventListener("offline",e)}),google.maps.event.addDomListener(window,"load",initializeMap),setTimeout(function(){ko.applyBindings(new UnionCityPlaceViewModel)},1e3);